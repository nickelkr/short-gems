<% @films.each do |film| %>
  <div class="row">
    <div class="col-12">
      <h2 style="font-family: Oswald;"><%= film.title %></h5>
      <h6 class="text-muted" style="font-family: Open Sans;"><%= film.runtime %> minutes</h6>
      <div class="row">
        <div class="col-1">
          <div style="padding-top: 20px;">
            <strong>+ <%= film.applauses.count %></strong>
          </div>
        </div>
        <div class="col-7">
          <iframe width="560"
            height="315"
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen
            src="https://www.youtube.com/embed/<%= film.external_id %>">
          </iframe>
        </div>
        <div class="col-4">
          <% Hash[Applause.categories.map { |k,_| [k,nil]}].merge(film.applauses.where(user: current_user).group_by(&:category)).each do |category, applause| %>
            <div class="row with-padding">
              <div class="col-2">
                <% if applause.present? %>
                  <button class="btn btn-primary btn-round"
                    data-film-id="<%= film.id %>"
                    data-category="<%= category %>"
                    data-category-id="<%= applause.first.id %>"
                    data-method="DELETE"><%= "\u2013" %></button>
                <% else %>
                  <button class="btn btn-outline-primary btn-round"
                    data-film-id="<%= film.id %>"
                    data-category="<%= category %>"
                      data-method="POST">+</button>
                <% end %>
              </div>
              <div class="col-10 category-vote-label"><%= category.upcase %></div>
            </div>
          <% end %>
        </div>
      </div>
      <% if current_user && (film.user_id == current_user.id || current_user.roles.admin?) %>
        <br />
        <%= link_to 'Remove film', film_path(film.id), { method: :delete, id: "remove-#{film.id}" } %>
      <% end %>
    </div>
  </div>
  <br />
  <br />
  <br />
<% end %>
<script>
  $('button').click(function() {
    applauseClick($(this));
  })
</script>
